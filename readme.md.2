# Exploiting Python PIL Module Command Execution Vulnerability

前段时间分析的一个漏洞，可能国内提及的人比较少，趁着这次活动抽出点时间写一篇文章讲讲。其实原本也想写php相关的内容，不过看了一下其他的人的投稿，感觉活动会被php占领，我只好来支持一下python阵营。欢迎大家提出建议和看法！

## PIL

PIL (Python Image Library) 应该是 Python 图片处理库中运用最广泛的，它拥有强大的功能和简洁的API。使用python作为开发语言的同学们，应该都多多少少了解过这个库。在 Mac 中它的安装方式为:

`pip install Pillow`

Windows安装PIL可能会因为各种原因比较吃力，所以我为大家准备了docker环境。本文的所有代码和环境都会放到里面供大家实验。link:[]().

本次的主题就是PIL库全版本，在服务器安装有GhostScript(Version<=9.21)时可能会产生的命令执行问题。

PIL会根据所处理图片的文件内容（并非后缀），自动识别文件类型，而在处理eps格式的过程中，如果环境里存在GhostScript(gs命令)，则会使用gs命令在SAFER模式下对图片进行处理(放大，缩小，取宽高等)。

## GhostButt CVE-2017-8291 : GhostScript SAFER模式bypass

 

GhostScript在处理eps格式的图片时，可以bypass

这个漏洞也算是在Twitter上非常火的漏洞，详情可以看binjo师傅的这一篇文章:[GhostButt - CVE-2017-8291利用分析](https://paper.seebug.org/310/),里面二进制相关的知识可能比较多，我们可以暂且不看。我们只需知道


